services:
  # --- Traefik Service (Reverse Proxy) ---
  traefik:
    image: traefik:v2.10
    container_name: traefik
    restart: always
    command:
      - "--providers.docker=true"
      - "--providers.docker.exposedbydefault=false"
      - "--entrypoints.web.address=:80"
      - "--entrypoints.websecure.address=:443"
      # Redirect HTTP -> HTTPS
      - "--entrypoints.web.http.redirections.entryPoint.to=websecure"
      - "--entrypoints.web.http.redirections.entryPoint.scheme=https"
      # Let's Encrypt (ถ้าไม่ใช้ Cloudflare Proxy)
      # - "--certificatesresolvers.letsencrypt.acme.email=your-email@example.com"
      # - "--certificatesresolvers.letsencrypt.acme.storage=/letsencrypt/acme.json"
      # - "--certificatesresolvers.letsencrypt.acme.httpchallenge.entrypoint=web"
    ports:
      - "80:80"
      - "443:443"
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock:ro
      # - ./letsencrypt:/letsencrypt  # สำหรับ Let's Encrypt
    networks:
      - web

  # --- Vue App Service ---
  vue-app:
    build: .
    container_name: my-vue-app
    restart: always
    labels:
      - "traefik.enable=true"
      - "traefik.docker.network=web"
      
      # === วิธีที่ 1: ใช้ Cloudflare Proxy (แนะนำ - ง่ายที่สุด) ===
      # Cloudflare จะ terminate SSL ให้ แล้วส่ง traffic มาที่ Traefik
      # ตั้ง SSL/TLS เป็น "Full" หรือ "Full (Strict)" ใน Cloudflare Dashboard
      - "traefik.http.routers.vue-app.rule=Host(`vue.devng.pro`) || Host(`www.vue.devng.pro`)"
      - "traefik.http.routers.vue-app.entrypoints=websecure"
      - "traefik.http.routers.vue-app.tls=true"
      
      # === วิธีที่ 2: ใช้ Let's Encrypt (ถ้าไม่ใช้ Cloudflare Proxy) ===
      # - "traefik.http.routers.vue-app.tls.certresolver=letsencrypt"
      
      - "traefik.http.services.vue-app.loadbalancer.server.port=3000"
    networks:
      - web

networks:
  web:
    name: web
    driver: bridge

